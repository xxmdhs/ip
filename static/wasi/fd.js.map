{"version":3,"sources":["../src/fd.ts"],"sourcesContent":["/* eslint @typescript-eslint/no-unused-vars:0 */\nimport * as wasi from \"./wasi_defs.js\";\n\nexport abstract class Fd {\n  fd_allocate(offset: bigint, len: bigint): number {\n    return wasi.ERRNO_NOTSUP;\n  }\n  fd_close(): number {\n    return 0;\n  }\n  fd_fdstat_get(): { ret: number; fdstat: wasi.Fdstat | null } {\n    return { ret: wasi.ERRNO_NOTSUP, fdstat: null };\n  }\n  fd_fdstat_set_flags(flags: number): number {\n    return wasi.ERRNO_NOTSUP;\n  }\n  fd_fdstat_set_rights(\n    fs_rights_base: bigint,\n    fs_rights_inheriting: bigint,\n  ): number {\n    return wasi.ERRNO_NOTSUP;\n  }\n  fd_filestat_get(): { ret: number; filestat: wasi.Filestat | null } {\n    return { ret: wasi.ERRNO_NOTSUP, filestat: null };\n  }\n  fd_filestat_set_size(size: bigint): number {\n    return wasi.ERRNO_NOTSUP;\n  }\n  fd_filestat_set_times(atim: bigint, mtim: bigint, fst_flags: number): number {\n    return wasi.ERRNO_NOTSUP;\n  }\n  fd_pread(size: number, offset: bigint): { ret: number; data: Uint8Array } {\n    return { ret: wasi.ERRNO_NOTSUP, data: new Uint8Array() };\n  }\n  fd_prestat_get(): { ret: number; prestat: wasi.Prestat | null } {\n    return { ret: wasi.ERRNO_NOTSUP, prestat: null };\n  }\n  fd_pwrite(\n    data: Uint8Array,\n    offset: bigint,\n  ): { ret: number; nwritten: number } {\n    return { ret: wasi.ERRNO_NOTSUP, nwritten: 0 };\n  }\n  fd_read(size: number): { ret: number; data: Uint8Array } {\n    return { ret: wasi.ERRNO_NOTSUP, data: new Uint8Array() };\n  }\n  fd_readdir_single(cookie: bigint): {\n    ret: number;\n    dirent: wasi.Dirent | null;\n  } {\n    return { ret: wasi.ERRNO_NOTSUP, dirent: null };\n  }\n  fd_seek(offset: bigint, whence: number): { ret: number; offset: bigint } {\n    return { ret: wasi.ERRNO_NOTSUP, offset: 0n };\n  }\n  fd_sync(): number {\n    return 0;\n  }\n  fd_tell(): { ret: number; offset: bigint } {\n    return { ret: wasi.ERRNO_NOTSUP, offset: 0n };\n  }\n  fd_write(data: Uint8Array): { ret: number; nwritten: number } {\n    return { ret: wasi.ERRNO_NOTSUP, nwritten: 0 };\n  }\n  path_create_directory(path: string): number {\n    return wasi.ERRNO_NOTSUP;\n  }\n  path_filestat_get(\n    flags: number,\n    path: string,\n  ): { ret: number; filestat: wasi.Filestat | null } {\n    return { ret: wasi.ERRNO_NOTSUP, filestat: null };\n  }\n  path_filestat_set_times(\n    flags: number,\n    path: string,\n    atim: bigint,\n    mtim: bigint,\n    fst_flags: number,\n  ): number {\n    return wasi.ERRNO_NOTSUP;\n  }\n  path_link(path: string, inode: Inode, allow_dir: boolean): number {\n    return wasi.ERRNO_NOTSUP;\n  }\n  path_unlink(path: string): { ret: number; inode_obj: Inode | null } {\n    return { ret: wasi.ERRNO_NOTSUP, inode_obj: null };\n  }\n  path_lookup(\n    path: string,\n    dirflags: number,\n  ): { ret: number; inode_obj: Inode | null } {\n    return { ret: wasi.ERRNO_NOTSUP, inode_obj: null };\n  }\n  path_open(\n    dirflags: number,\n    path: string,\n    oflags: number,\n    fs_rights_base: bigint,\n    fs_rights_inheriting: bigint,\n    fd_flags: number,\n  ): { ret: number; fd_obj: Fd | null } {\n    return { ret: wasi.ERRNO_NOTDIR, fd_obj: null };\n  }\n  path_readlink(path: string): { ret: number; data: string | null } {\n    return { ret: wasi.ERRNO_NOTSUP, data: null };\n  }\n  path_remove_directory(path: string): number {\n    return wasi.ERRNO_NOTSUP;\n  }\n  path_rename(old_path: string, new_fd: number, new_path: string): number {\n    return wasi.ERRNO_NOTSUP;\n  }\n  path_unlink_file(path: string): number {\n    return wasi.ERRNO_NOTSUP;\n  }\n}\n\nexport abstract class Inode {\n  ino: bigint;\n\n  constructor() {\n    this.ino = Inode.issue_ino();\n  }\n\n  // NOTE: ino 0 is reserved for the root directory\n  private static next_ino: bigint = 1n;\n  static issue_ino(): bigint {\n    return Inode.next_ino++;\n  }\n  static root_ino(): bigint {\n    return 0n;\n  }\n\n  abstract path_open(\n    oflags: number,\n    fs_rights_base: bigint,\n    fd_flags: number,\n  ): { ret: number; fd_obj: Fd | null };\n\n  abstract stat(): wasi.Filestat;\n}\n"],"names":["wasi","Fd","fd_allocate","offset","len","ERRNO_NOTSUP","fd_close","fd_fdstat_get","ret","fdstat","fd_fdstat_set_flags","flags","fd_fdstat_set_rights","fs_rights_base","fs_rights_inheriting","fd_filestat_get","filestat","fd_filestat_set_size","size","fd_filestat_set_times","atim","mtim","fst_flags","fd_pread","data","Uint8Array","fd_prestat_get","prestat","fd_pwrite","nwritten","fd_read","fd_readdir_single","cookie","dirent","fd_seek","whence","fd_sync","fd_tell","fd_write","path_create_directory","path","path_filestat_get","path_filestat_set_times","path_link","inode","allow_dir","path_unlink","inode_obj","path_lookup","dirflags","path_open","oflags","fd_flags","ERRNO_NOTDIR","fd_obj","path_readlink","path_remove_directory","path_rename","old_path","new_fd","new_path","path_unlink_file","Inode","issue_ino","next_ino","root_ino","constructor","ino"],"mappings":"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"}